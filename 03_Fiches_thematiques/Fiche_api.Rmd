# Travailler avec des API

<!-- ## Tâches concernées et recommandations -->

<!-- Quelques détails sur la tâche dont il s'agit -->

<!-- ::: {.recommandation data-latex=""} -->

<!-- Dire en 4-5 lignes comment il est recommandé de procéder: -->

<!-- * le ou les *package*(*s*) dont l'usage est recommandé; si on recommande plusieurs *packages*, expliquer comment choisir lequel (en fonction de la taille des données, du format...) -->
<!-- * les *packages* dont l'usage est déconseillé;  -->
<!-- * les autres points de méthode essentiels. -->

<!-- ::: -->

## Rappels des notions essentielles sur les API

Une *Application Programming Interface* (ou **API**) est une interface applicative de programmation qui permet d'utiliser une application existante pour restituer des données. Il s'agit d'une façade clairement délimitée par laquelle un logiciel offre des services à d'autres logiciels (ou utilisateurs). L'objectif est de fournir une porte d'accès à une fonctionnalité en cachant les détails de la mise en œuvre. 

Ce terme peut faire peur, mais il s'agit en fait simplement d'une façon de restituer des données. Plutôt que d'attaquer directement des bases de données, qui sont volumineuses et complexes, des outils ont été développés pour faire le travail intermédiaire et restituer la données sous forme de service.

À l'Insee comme ailleurs, la connexion inter bases de données pour les nouveaux projets tend à se réaliser via des API, afin de limiter le nombre de personne ayant accès aux bases, mais aussi pour faciliter les accès avec des services sur-mesures pour les utilisateurs.

Comme pour l'utilisation d'une fonction ou d'une macro SAS, l'appel d'une API s'effectue via des paramètres.
Certaines API propose un portail contenant une IHM (catalogue des API). Cependant, une API est majoritairement utilisée pour automatiser un process ou effectuer du chargement de masse, sont accès s'effectuera donc par l'utilisation d'une url contenant les paramètres.  Ces paramètres sont à renseigner pour compléter l'url du service.
Prenons l'exemple de l'API Sirene, l'url a utiliser pour avoir des informations sur un siren est : https://api.insee.fr/entreprises/sirene/V3/siren/{siren} (modifier {siren} en renseignant le numéro du siren).


 

::: {.conseil data-latex=""}

Cette boîte colorée sert à donner un conseil. Son usage n'est évidemment pas obligatoire.

:::

::: {.remarque data-latex=""}

Cette boîte colorée sert à faire une remarque. Son usage n'est évidemment pas obligatoire.

:::

### Réaliser la tâche, cas 1

Lorsqu'on est débutant, il faut utiliser la fonction `super_fonction()` du *package* `super_package`.

La fonction `super_fonction()` fonctionne comme ceci par défaut: blabla.

La fonction `super_fonction()` propose beaucoup d'options:

* `option1`: blabla;
* `option2`: blabla;
* `option3`: blabla.

Voici un premier exemple de code (le plus simple possible, en utilisant des données facilement disponibles sur le site de l'Insee):

```{r, eval = FALSE}
library(super_package)
output <- super_fonction(arguments)
```

Ne pas oublier d'expliquer ce qu'on obtient comme output.

Voici un second exemple de code, avec des options un peu plus avancées:

```{r, eval = FALSE}
output <- super_fonction(arguments et options)
```


### Réaliser la tâche, cas 2

Lorsqu'on est plus avancé, on peut utiliser la fonction `hyper_fonction()` du *package* `hyper_package`.

* Comportement par défaut;
* Principales options;
* Exemples de code.

## Quelques bonnes pratiques

Quelques conseils généraux sur la façon de s'y prendre.

* Faut-il préprocesser les données avant de réaliser la tâche;
* Comment minimiser les temps de calculs/la charge en RAM.

## Sources

Si le rédacteur de la fiche a réutilisé des ressources externes en français disponible en licence libre, il faut indiquer ici l'URL des ressources, le nom des auteurs et la licence de réutilisation de ces ressources.

## Ressources

* la documentation des *packages*;
* les vignettes et *cheatsheets* si elles existent;
* les formations proposées par l'Insee;
* les formations/tutoriels disponibles sur internet.

Dans la mesure du possible, il faut veiller à proposer des ressources en français.
